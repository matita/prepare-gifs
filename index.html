<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Prepare GIFs for sharing</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" media="screen" href="main.css" />
    
</head>
<body>
    <div>
        <label>Select GIF</label>
        <input id="file-input" type="file" >
        <div id="frames"></div>
    </div>

    <script src="gifuct-js.js"></script>
    <script>
        var fileInput = document.getElementById('file-input');
        var framesContainer = document.getElementById('frames');

        fileInput.onchange = onFileSelected;


        function onFileSelected(e) {
            var reader = new FileReader();
            reader.onload = function() {
                var arrayBuffer = this.result;
                var array = new Uint8Array(arrayBuffer);
                parseGIFArrayBuffer(array);
            }
            reader.readAsArrayBuffer(this.files[0]);
        }

        function parseGIFArrayBuffer(arrayBuffer) {
            var gif = new GIF(arrayBuffer);
            var frames = gif.decompressFrames(true);
            displayFrames(frames);
        }

        function displayFrames(frames) {
            var canvases = frames.map(frameToCanvas);

            canvases.forEach(function (canvas) {
                framesContainer.appendChild(canvas);
            });
        }

        function frameToCanvas(frame) {
            var w = frame.dims.width;
            var h = frame.dims.height;
            var canvas = document.createElement('canvas');
            var ctx = canvas.getContext('2d');
            var frameImageData = ctx.createImageData(w, h);
            
            canvas.width = w;
            canvas.height = h;
            frameImageData.data.set(frame.patch);
            ctx.putImageData(frameImageData, 0, 0);

            return canvas;
        }
    </script>
</body>
</html>